# 智能理财助手系统设计方案

> 一个由大模型驱动的每日基金分析与决策系统

---

## 1. 系统概述

### 1.1 核心功能

```
┌─────────────────────────────────────────────────────────────────────┐
│                        智能理财助手系统                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐            │
│  │  每日资讯采集  │ → │  AI分析引擎   │ → │  决策生成器   │            │
│  └──────────────┘   └──────────────┘   └──────────────┘            │
│         ↓                   ↓                   ↓                   │
│  ┌──────────────┐   ┌──────────────┐   ┌──────────────┐            │
│  │  持仓监控器   │ ← │  风险控制器   │ ← │  执行建议器   │            │
│  └──────────────┘   └──────────────┘   └──────────────┘            │
│                              ↓                                       │
│                     ┌──────────────┐                                │
│                     │  每日报告生成  │                                │
│                     └──────────────┘                                │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 1.2 设计原则

1. **谨慎优先**：宁可错过机会，不可冒险损失
2. **透明可追溯**：每个决策都有详细的理由记录
3. **多重验证**：重要决策需要多个信号确认
4. **风险控制**：严格的止损和仓位管理
5. **人工确认**：大额操作需要用户确认

---

## 2. 数据采集模块

### 2.1 数据源

| 数据类型 | 数据源 | 更新频率 | 用途 |
|---------|-------|---------|-----|
| 基金净值 | 天天基金API | 每日 | 基金表现跟踪 |
| 指数估值 | 中证指数官网 | 每日 | 估值判断 |
| 市场新闻 | 财经网站 | 实时 | 市场情绪分析 |
| 宏观数据 | 统计局/央行 | 月度 | 大趋势判断 |
| 基金持仓 | 基金季报 | 季度 | 基金分析 |

### 2.2 采集频率

```
每日定时任务：
├── 09:00 - 采集隔夜市场新闻、全球市场表现
├── 09:30 - 开盘数据采集
├── 11:30 - 上午盘面分析
├── 15:00 - 收盘数据采集
├── 16:00 - 基金净值更新
├── 18:00 - 生成每日分析报告
└── 20:00 - 发送每日建议通知
```

---

## 3. 持仓管理模块

### 3.1 持仓数据结构

```python
{
    "portfolio": {
        "total_value": 100000,          # 总资产
        "cash": 20000,                  # 现金
        "positions": [
            {
                "fund_code": "110011",
                "fund_name": "易方达中小盘",
                "shares": 1000,         # 持有份额
                "cost_price": 5.0,      # 成本价
                "current_price": 5.5,   # 当前净值
                "market_value": 5500,   # 市值
                "profit_loss": 500,     # 盈亏
                "profit_rate": 0.10,    # 收益率
                "buy_date": "2024-01-01",
                "hold_days": 365
            }
        ]
    }
}
```

### 3.2 持仓监控指标

- **单只基金仓位**：不超过总资产的20%
- **同类型基金仓位**：不超过总资产的40%
- **总权益仓位**：根据市场估值动态调整
- **浮亏预警**：单只基金亏损超过10%预警

---

## 4. 决策引擎

### 4.1 买入决策条件

```
买入信号 = 综合评分 ≥ 70分

评分维度：
├── 基金质量评分 (30分)
│   ├── 长期业绩排名
│   ├── 基金经理能力
│   ├── 基金规模适中
│   └── 费率合理
├── 估值评分 (30分)
│   ├── 指数PE/PB历史百分位
│   ├── 市场情绪指标
│   └── 与历史低位的距离
├── 趋势评分 (20分)
│   ├── 短期均线趋势
│   ├── 资金流向
│   └── 市场热度
└── 风险评分 (20分)
    ├── 最大回撤控制
    ├── 波动率
    └── 与持仓的相关性
```

### 4.2 卖出决策条件

```
卖出触发条件（满足任一）：

【止盈条件】
├── 收益率达到目标（根据基金类型：15%-30%）
├── 估值进入高估区域（PE百分位 > 80%）
└── 市场情绪过热（多指标共振）

【止损条件】
├── 亏损超过15%（硬止损）
├── 连续20个交易日跑输基准5%+
└── 基金经理变更/风格漂移

【调仓条件】
├── 仓位超过上限
├── 有更好的替代标的
└── 资产配置再平衡需要
```

### 4.3 决策置信度

每个建议都会附带置信度评级：

| 置信度 | 说明 | 建议操作 |
|-------|------|---------|
| ★★★★★ | 强烈建议 | 可直接执行 |
| ★★★★☆ | 建议执行 | 可执行 |
| ★★★☆☆ | 可以考虑 | 建议观望 |
| ★★☆☆☆ | 信号不强 | 不建议操作 |
| ★☆☆☆☆ | 不建议 | 继续观察 |

---

## 5. 风险控制系统

### 5.1 仓位控制规则

```python
# 根据市场估值动态调整仓位上限
def get_max_position(market_pe_percentile):
    if market_pe_percentile < 20:    # 极度低估
        return 0.90  # 最高90%仓位
    elif market_pe_percentile < 40:  # 低估
        return 0.75
    elif market_pe_percentile < 60:  # 正常
        return 0.60
    elif market_pe_percentile < 80:  # 高估
        return 0.40
    else:                            # 极度高估
        return 0.20  # 最多20%仓位
```

### 5.2 单笔交易限制

- **单次买入**：不超过可用资金的30%
- **单只基金**：累计不超过总资产的20%
- **每日操作**：最多执行3笔交易
- **买入冷静期**：同一基金两次买入间隔至少7天

### 5.3 熔断机制

```
系统熔断条件：
├── 单日总资产下跌超过3% → 暂停所有买入
├── 周内总资产下跌超过5% → 暂停交易，发送预警
├── 月内总资产下跌超过10% → 建议减仓，人工介入
└── 市场出现极端波动（指数单日跌幅>5%）→ 暂停交易
```

### 5.4 异常检测

- 基金净值异常波动检测
- 基金经理变更检测
- 基金规模异常变化检测
- 持仓风格漂移检测

---

## 6. 每日报告

### 6.1 报告内容

```
【每日理财报告】2026-01-24

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 今日持仓概览
├── 总资产：¥100,500.00
├── 日收益：+¥500.00 (+0.50%)
├── 总收益：+¥5,500.00 (+5.78%)
└── 现金余额：¥20,000.00

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📈 持仓明细
┌────────────────────────────────────────────┐
│ 易方达中小盘(110011)                         │
│ 持有份额: 1000份  |  成本: 5.00              │
│ 当前净值: 5.50    |  盈亏: +10.00%           │
│ 市值: ¥5,500      |  仓位占比: 5.5%          │
└────────────────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📰 今日市场要点
├── 沪深300收涨1.2%，市场情绪回暖
├── 美联储释放鸽派信号，外资流入
└── 新能源板块持续活跃

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 今日建议

【买入建议】
├── 沪深300ETF联接(000961)
│   └── 理由：估值处于历史30%分位，长期配置价值
│   └── 建议金额：¥5,000
│   └── 置信度：★★★★☆

【持有建议】
├── 易方达中小盘(110011)
│   └── 理由：趋势良好，继续持有
│   └── 置信度：★★★★★

【卖出建议】
├── 无

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

⚠️ 风险提示
├── 当前总仓位：80%，接近上限
└── 科技类基金占比较高，注意分散

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 7. 技术架构

### 7.1 目录结构

```
fund/
├── config/
│   ├── settings.py          # 系统配置
│   └── risk_rules.py        # 风控规则
├── data/
│   ├── portfolio.json       # 持仓数据
│   ├── trade_history.json   # 交易历史
│   └── daily_reports/       # 每日报告存档
├── src/
│   ├── collector/           # 数据采集模块
│   │   ├── fund_data.py     # 基金数据采集
│   │   ├── market_news.py   # 市场新闻采集
│   │   └── index_valuation.py # 指数估值采集
│   ├── analyzer/            # 分析模块
│   │   ├── fund_analyzer.py # 基金分析
│   │   ├── market_analyzer.py # 市场分析
│   │   └── ai_advisor.py    # AI顾问（大模型调用）
│   ├── portfolio/           # 持仓管理
│   │   ├── manager.py       # 持仓管理器
│   │   └── monitor.py       # 持仓监控
│   ├── decision/            # 决策引擎
│   │   ├── buy_signal.py    # 买入信号
│   │   ├── sell_signal.py   # 卖出信号
│   │   └── risk_control.py  # 风控检查
│   ├── report/              # 报告生成
│   │   └── daily_report.py  # 每日报告
│   └── notify/              # 通知模块
│       └── notifier.py      # 消息通知
├── main.py                  # 主程序入口
├── scheduler.py             # 定时任务调度
└── requirements.txt         # 依赖包
```

### 7.2 技术栈

- **语言**：Python 3.10+
- **数据采集**：requests, aiohttp
- **数据处理**：pandas, numpy
- **AI引擎**：OpenAI API / 本地大模型
- **定时任务**：APScheduler
- **数据存储**：JSON / SQLite
- **通知推送**：邮件 / 企业微信 / 钉钉

---

## 8. 安全与合规

### 8.1 数据安全

- 敏感配置信息使用环境变量
- 持仓数据本地加密存储
- 交易记录完整保留，可追溯

### 8.2 合规提醒

- 系统仅提供建议，不自动执行交易
- 所有建议基于公开数据分析
- 不构成投资建议，仅供参考
- 投资有风险，决策需谨慎

---

## 9. 使用流程

```
1. 初始化系统
   └── 配置API密钥、持仓信息、风控参数

2. 每日运行
   ├── 自动采集数据
   ├── AI分析生成建议
   ├── 风控检查
   └── 生成报告并通知

3. 用户操作
   ├── 查看每日报告
   ├── 根据建议手动执行交易
   └── 更新持仓信息

4. 持续优化
   ├── 记录决策效果
   ├── 调整策略参数
   └── 回测验证
```

---

*设计版本：1.0*
*设计日期：2026年1月*
