# 智能理财助手

一个由大模型驱动的每日基金分析与投资决策系统。

## 功能特点

### 核心功能
- **每日资讯采集**：自动获取市场行情、指数估值、财经新闻
- **AI智能分析**：利用大模型分析市场状况和基金表现
- **持仓监控**：实时跟踪持仓收益，自动更新净值
- **买卖建议**：基于多维度评分和风控规则给出交易建议
- **风险控制**：严格的仓位管理、止盈止损、熔断机制
- **每日报告**：生成详细的分析报告并推送通知

### 风控机制
- 单只基金仓位上限 20%
- 同类基金仓位上限 40%
- 单次买入不超过可用资金 30%
- 每日最多执行 3 笔交易
- 同一基金买入冷静期 7 天
- 止损线 -15%
- 市场大跌自动熔断

## 快速开始

### 1. 安装依赖

```bash
cd fund
pip install -r requirements.txt
```

### 2. 配置环境变量

```bash
# 复制配置模板
cp .env.example .env

# 编辑 .env 文件，填写实际配置
```

**必要配置**：
- `OPENAI_API_KEY`：用于AI分析（可选，不配置则使用规则引擎）

**推荐配置 - 企业微信通知**：
- `WECOM_WEBHOOK`：企业微信机器人Webhook地址

配置企业微信（详见 `docs/企业微信配置指南.md`）：
1. 打开企业微信 → 创建群聊
2. 群设置 → 群机器人 → 添加机器人
3. 复制Webhook地址到 `.env` 文件

**其他可选配置**：
- 邮件通知：`SMTP_*` 相关配置
- 钉钉：`DINGTALK_WEBHOOK`

### 3. 运行程序

#### 交互式命令行
```bash
python main.py
```

#### 可用命令
```
init <金额>       - 初始化投资组合（如：init 100000）
buy <代码> <金额> - 买入基金（如：buy 000961 5000）
sell <代码> [比例] - 卖出基金（如：sell 000961 0.5）
watch <代码>      - 添加到关注列表
unwatch <代码>    - 从关注列表移除
analyze          - 运行每日分析生成报告
notify           - 运行分析并发送企业微信通知
suggest <代码>   - 获取单只基金的建议
portfolio        - 查看当前持仓
market           - 查看市场概览
test_wecom       - 测试企业微信连接
help             - 显示帮助
quit             - 退出程序
```

### 4. 定时任务

启动自动化定时任务（会在后台持续运行）：

```bash
python scheduler.py
```

立即执行一次分析（用于测试）：
```bash
python scheduler.py --once
```

定时任务计划：
- 09:00 - 早间数据采集
- 11:30 - 午间市场检查
- 14:30 - 午后市场检查
- 18:00 - 每日分析报告

## 使用示例

### 初始化投资组合
```
> init 100000
投资组合已初始化，初始资金: ¥100,000.00
```

### 添加关注基金
```
> watch 000961
已添加 天弘沪深300ETF联接A 到关注列表

> watch 001617
已添加 天弘中证500指数增强A 到关注列表
```

### 运行分析
```
> analyze
正在分析，请稍候...

╔══════════════════════════════════════════════════════════════════╗
║                     【每日理财报告】                              ║
║                   2026年01月24日 周五                            ║
╚══════════════════════════════════════════════════════════════════╝
...
```

### 买入基金
```
> buy 000961 5000
✅ 买入成功
```

### 查看持仓
```
> portfolio

=====================================
📊 当前持仓
=====================================
总资产: ¥100,000.00
现金: ¥95,000.00
仓位: 5.0%
总收益: ¥0.00 (0.00%)
-------------------------------------

天弘沪深300ETF联接A (000961)
  类型: 指数基金
  份额: 3,125.00
  市值: ¥5,000.00
  收益: +0.00%
=====================================
```

### 获取建议
```
> suggest 001617

基金: 天弘中证500指数增强A (001617)
建议: 买入
置信度: ★★★★☆
理由: 估值处于历史40%分位，综合评分75分
```

## 项目结构

```
fund/
├── config/
│   ├── __init__.py
│   └── settings.py          # 系统配置
├── data/
│   ├── portfolio.json       # 持仓数据
│   ├── trade_history.json   # 交易历史
│   ├── watch_list.json      # 关注列表
│   └── daily_reports/       # 每日报告存档
├── src/
│   ├── collector/           # 数据采集模块
│   │   ├── fund_data.py     # 基金数据
│   │   ├── index_valuation.py # 指数估值
│   │   └── market_news.py   # 市场新闻
│   ├── analyzer/            # 分析模块
│   │   └── ai_advisor.py    # AI顾问
│   ├── portfolio/           # 持仓管理
│   │   └── manager.py       # 持仓管理器
│   ├── decision/            # 决策引擎
│   │   ├── engine.py        # 决策引擎
│   │   └── risk_control.py  # 风险控制
│   ├── report/              # 报告生成
│   │   └── daily_report.py  # 每日报告
│   └── notify/              # 通知模块
│       └── notifier.py      # 通知推送
├── main.py                  # 主程序入口
├── scheduler.py             # 定时任务
├── requirements.txt         # 依赖包
├── .env.example             # 环境变量模板
└── README.md                # 使用说明
```

## 评分系统

### 基金评分维度
| 维度 | 权重 | 说明 |
|-----|------|-----|
| 质量评分 | 30% | 长期业绩、基金经理、规模 |
| 估值评分 | 30% | 跟踪指数的估值水平 |
| 趋势评分 | 20% | 近期表现、市场趋势 |
| 风险评分 | 20% | 波动率、回撤控制 |

### 置信度等级
| 等级 | 星级 | 说明 |
|-----|------|-----|
| 5 | ★★★★★ | 强烈建议，可直接执行 |
| 4 | ★★★★☆ | 建议执行 |
| 3 | ★★★☆☆ | 可以考虑 |
| 2 | ★★☆☆☆ | 信号不强，建议观望 |
| 1 | ★☆☆☆☆ | 不建议操作 |

## 数据来源

- 基金净值：天天基金网
- 指数估值：蛋卷基金
- 市场行情：东方财富

## 注意事项

1. **风险提示**：本系统仅供学习参考，不构成投资建议。投资有风险，入市需谨慎。
2. **API限制**：数据接口可能有访问频率限制，请勿频繁调用。
3. **AI依赖**：如果未配置OpenAI API，系统将使用内置规则引擎进行分析。
4. **交易执行**：系统只提供建议，实际交易需要您在基金销售平台手动操作。
5. **数据延迟**：基金净值数据通常在交易日晚间更新。

## 免责声明

本软件仅供学习和研究使用，不构成任何投资建议。作者不对使用本软件造成的任何损失负责。投资有风险，决策需谨慎。

## 已完成功能 ✅

### v1.0 核心功能（2026年1月）

#### 🏗️ 系统架构
- [x] 模块化系统设计（采集、分析、决策、风控、通知分离）
- [x] 交互式命令行界面（CLI）
- [x] 定时任务调度器（APScheduler）
- [x] 配置管理（环境变量 + 配置文件）

#### 📊 数据采集模块
- [x] 基金净值数据采集（天天基金网 API）
- [x] 指数估值数据采集（蛋卷基金）
- [x] 市场新闻资讯采集
- [x] 主要指数行情获取

#### 🤖 AI 分析模块
- [x] OpenAI API 集成（GPT-4 等模型支持）
- [x] 备用规则引擎（无 API Key 时自动切换）
- [x] 市场趋势分析
- [x] 基金投资建议生成

#### 💼 持仓管理模块
- [x] 投资组合初始化
- [x] 基金买入/卖出操作
- [x] 持仓收益实时计算
- [x] 交易历史记录
- [x] 关注列表管理

#### 🎯 决策引擎
- [x] 多维度综合评分系统（质量/估值/趋势/风险）
- [x] 买入信号识别
- [x] 卖出信号识别
- [x] 置信度评级（5星制）

#### 🛡️ 风险控制模块
- [x] 单只基金仓位限制（20%）
- [x] 同类基金仓位限制（40%）
- [x] 单次买入限制（30%）
- [x] 每日交易次数限制
- [x] 买入冷静期（7天）
- [x] 止损线设置（-15%）
- [x] 市场熔断机制

#### 📝 报告生成模块
- [x] 每日分析报告生成
- [x] 持仓详情展示
- [x] 买卖建议汇总
- [x] 报告存档（JSON + TXT）

#### 📢 通知推送模块
- [x] 企业微信机器人通知
- [x] Markdown 格式消息
- [x] 连接测试功能

---

## 开发计划 🚀

### v1.1 数据增强（计划中）
- [ ] 更多数据源接入（东方财富、同花顺）
- [ ] 基金持仓数据采集（季报解析）
- [ ] 基金经理信息跟踪
- [ ] 历史数据本地缓存
- [ ] 分红/拆分数据处理

### v1.2 智能分析升级
- [ ] 基金筛选器（多条件筛选优质基金）
- [ ] 行业轮动分析
- [ ] 资金流向分析
- [ ] 市场情绪指标
- [ ] 更精细的估值模型

### v1.3 回测系统
- [ ] 历史数据回测框架
- [ ] 策略效果验证
- [ ] 收益/回撤/夏普比率统计
- [ ] 回测报告生成
- [ ] 参数优化工具

### v1.4 通知渠道扩展
- [ ] 钉钉机器人通知
- [ ] 邮件通知（SMTP）
- [ ] Telegram Bot
- [ ] 微信公众号推送

### v1.5 存储升级
- [ ] SQLite 数据库存储
- [ ] 持仓历史快照
- [ ] 净值数据本地数据库
- [ ] 数据导入/导出功能

### v2.0 Web 界面（长期）
- [ ] Web Dashboard 仪表盘
- [ ] 持仓可视化图表
- [ ] 收益曲线展示
- [ ] 在线参数配置
- [ ] 移动端适配

### v2.1 高级功能（长期）
- [ ] 自定义策略编辑器
- [ ] 多账户管理
- [ ] 组合再平衡建议
- [ ] 税务计算辅助
- [ ] 定投计划管理

---

## 版本历史

| 版本 | 日期 | 说明 |
|-----|------|-----|
| v1.0.0 | 2026-01-30 | 初始版本，完成核心功能 |

---

## 许可证

MIT License
